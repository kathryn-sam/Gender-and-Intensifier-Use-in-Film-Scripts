---
title: "StatisticalAnalysis"
author: "Kathryn Sam"
date: "2025-12-11"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(lme4) # linear mixed effects models
library(lmerTest) # p values for lme4 output
library(sjPlot) # tables
library(psych) # descriptives
library(glmmTMB) # assumption checks
library(tidyverse) # plots
library(robustlmm) # robust models
```

## Data setup

Load file

```{r load file}
dfSpacy<-read_excel('MovieData_Spacy.xlsx')

```

Change variable types and recode variables.
```{r variable recode}
# Recode character gender for interpretation
dfSpacy$CharIsWoman <- ifelse(dfSpacy$Gender == "M", 0, 1)

# Convert variable to factor
dfSpacy$CharIsWoman<-as.factor(dfSpacy$CharIsWoman)

# Recode writer gender for interpretation
# Man = 0, Both = 1, Woman = 2
dfSpacy$WriterGender <- ifelse(dfSpacy$WriterGender == "M", 0, 
                               ifelse(dfSpacy$WriterGender == "B", 1, 2))
dfSpacy$WriterGender= as.factor(dfSpacy$WriterGender) # Convert to factor

dfSpacy$MovieYear = as.numeric(dfSpacy$MovieYear) # Convert variable to numeric

```

### Check and remove movies which have no text in either character gender category

```{r NAs}
# Replace intensifiers with NA for rows with no word count
dfSpacy$intensifiers <- ifelse(dfSpacy$NW == 0, NA, dfSpacy$intensifiers)

# Inspect NAs
sum(is.na(dfSpacy$intensifiers))

# Check if NAs are related to Char Sex code
table(is.na(dfSpacy$intensifiers), dfSpacy$CharIsWoman)

# Count movies with no Text for both Male and Female
movies_no_text <- dfSpacy %>%
  group_by(MovieID) %>%
  summarise(
    no_text_male = all(is.na(Text[CharIsWoman == 0])),
    no_text_female = all(is.na(Text[CharIsWoman == 1]))
  ) %>%
  filter(no_text_male & no_text_female)

# Number of movies with no Text data
print(paste("Number of movies with no Text data:", nrow(movies_no_text)))

#Drop if movies have no text for either M or F
dfSpacy2 <- dfSpacy %>%
  filter(!MovieID %in% movies_no_text$MovieID)

# Final data 
length(unique(dfSpacy2$MovieID))

```
## Descriptives

Movie Year

```{r movieyear}
describe(dfSpacy2$MovieYear) # Descriptives
hist(dfSpacy2$MovieYear, xlab = "Year of release") # Histogram
```

Writer Gender

```{r}
describe(dfSpacy2$WriterGender) # Descriptives

ggplot(dfSpacy2, aes(x = WriterGender)) + # Bar chart
  geom_bar() +
  geom_text(stat = "count", 
            aes(label = after_stat(count)), 
            vjust = -0.5) +
  labs(x = "Values", y = "Count", title = "Screenwriters") +
  scale_x_discrete(labels = c("Man/Men", "Men and Women", "Woman/Women"))+ 
  theme_minimal()
```

Intensifiers

```{r}
describe(dfSpacy2$intensifiers) # Descriptives
hist(dfSpacy2$intensifiers, xlab = "Intensifiers per M words") # Histogram
```

## Plots

Intensifiers by Character Gender

```{r}
ggplot(dfSpacy2, aes(x=CharIsWoman, y=intensifiers, 
                     fill=CharIsWoman)) + 
  geom_boxplot() + scale_x_discrete(labels = c("Men", "Women"))+ 
  scale_fill_manual(values = c("#785EF0", "#FE6100"))+
  labs(x = "Character Gender", y = "Intensifiers per M words") +
  theme(axis.text = element_text(color = "black")) +
  theme_minimal()+ theme(legend.position = "none") 

ggsave("IntByChar.svg") # Save plot

```
```{r}
dfSpacy2 %>%
  group_by(CharIsWoman) %>%
  summarise(median(intensifiers, na.rm = TRUE))

```



Intensifiers by Writer Gender

```{r}
ggplot(dfSpacy2, aes(x=WriterGender, y=intensifiers, 
                     fill=as.factor(WriterGender))) + 
  scale_fill_manual(values = c("#785EF0", "#FFB000", "#FE6100"))+
  geom_boxplot() + 
  scale_x_discrete(labels = c("Man/Men", "Men and Women", "Women"))+ 
  labs(x = "Screenwriter Gender", y = "Intensifiers per M words") + 
  theme_minimal()+ theme(axis.text = element_text(color = "black"))+
  theme(legend.position = "none") 

ggsave("IntByWrGender.svg") # Save plot

```

```{r}
dfSpacy2 %>%
  group_by(WriterGender) %>%
  summarise(median(intensifiers, na.rm = TRUE))
```


Intensifiers over time by character

```{r}
ggplot(dfSpacy2, aes(x = MovieYear, y = intensifiers, 
                     color = CharIsWoman)) +
  geom_point() + 
  labs(color="Character Gender", x = "Movie Year", 
       y = "Intensifiers per M words") +
  geom_smooth(method=lm) +
  scale_color_manual(values = c("#785EF0", "#FE6100"), 
                     labels = c("Man", "Woman")) + theme_minimal() + 
  theme(axis.text = element_text(color = "black"))

ggsave("timeplot.svg")
```

## Statistical Models
Null model

```{r}
nullmodel <- lmer (intensifiers~(1|MovieID), data = dfSpacy, REML = FALSE)
summary(nullmodel)
# tab_model(nullmodel,, show.se=TRUE, show.ci=FALSE, show.aicc=TRUE)
```
Model with predictors

A random slopes model is not possible given the data.
```{r}
# model1.1<- lmer (intensifiers~(CharIsWoman|MovieID) + CharIsWoman*MovieYear +WriterGender, 
              #  data = dfSpacy2, REML = FALSE, lmerControl(autoscale = TRUE))

#Error: number of observations (=1094) <= number of random effects (=1188) for term (CharIsWoman | MovieID); the random-effects parameters and the residual variance (or scale parameter) are probably unidentifiable

```
Random intercept model
```{r}
model1.2 <- lmer (intensifiers~(1|MovieID) + CharIsWoman*MovieYear +WriterGender, 
                data = dfSpacy2, REML = FALSE, lmerControl(autoscale = TRUE))
summary(model1.2)
# tab_model(model1.2, df.method = "satterthwaite", show.se=TRUE, show.ci=FALSE, 
# show.icc=FALSE, show.aicc=TRUE)
```
Model assumptions

```{r}
plot_model(model1.2, type='diag')
```
As residuals are not homoscedastic, try running a model using robust lmer.
Overall conclusions are the same, so retain model 1.2. 


```{r}
model2<- rlmer(intensifiers~(1|MovieID)+CharIsWoman*MovieYear+WriterGender, 
               data = dfSpacy2,
               REML = FALSE, lmerControl(autoscale = TRUE))
summary(model2)
# tab_model(model2, show.se=TRUE, df.method = "satterthwaite", show.ci=FALSE, 
# show.icc=FALSE) view model 
```



